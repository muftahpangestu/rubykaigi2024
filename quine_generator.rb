rabbit = <<~RABBIT
01111110000000000000000000000000000000000000000000111100000000000000000000000000
00110001000000000000000000000000000000000000000111111100000000000000000000000000
00011100100000000000000000000000000000000001111100011110000000000000000000000000
00001110110000000000000000000000000000011100000111111110000000000000000000000000
00000111011000000000000000000000000000110000111111111100000000000000000000000000
00001111011000000000000000000000000000100011111111111000000000000000000000000000
00011110011000000000000000000000000000101111111111000000000000000000000000000000
00011100011000000000000000000000000000101111111000000000000000000000000000000000
00111100001100000000000000000000000000101111111000000000000000000000000000000000
00111110000110000000000000000000000010001110111000000000000000000000000000000000
00011111100001100000000000000000011100010111111000000000000000000000000000000000
00001111110000010000000000000001000001111111011000000000000000000000000000000000
00000001111000010001111111111110011111111111100000000000000000000000000000000000
00000000011111110111110000000111011111010100000000000000000000000000000000000000
00000001110111111010000000000011011101110000000000000000000000000000000000000000
00000011011111000000000000000000000001111100000000000000000000000000000000000000
00000111100000000100000000000000000000000111100000000000000000000000000000000000
00001110000110001000000010000000000100001011111100000000000000000000000000000000
00011110001100011011000011001101100100011111011111110000000000000000000000000000
00101110001000111010110110100101011100011111011101010000000000000000000000000000
01010110010001110111011010111111111001011111010010011101110000000000000000000000
11111100010001001111111111111111101011001011111011000011001110000000000000000000
11111010011010000110011100000011111111011001101001110000100001110000000000000000
11111110011111100110000100011101110110010011101000101100001010001110000000000000
00110111001110010000000000001110111110110010111100110011100001110000111000000000
00010110111110111000000000001110110101010100100100111111111000001110000101100000
00000011101110011000000000000000111110101101100110011111111111000001010000001110
00000000101001000001000000000001111111110011111010001001111111000000001111111111
00000001110011100000000000000001110011110111101001100100011111111111111000111100
00000001100110110000011110000011110011011110101111111111100111111110001111111111
00000010111110011000000000000011111001110011100011111111111111011100000001110000
00000101110000100111110001111101111100110100001111000000111011111111111000001110
00000110111001101101100111000001101110111101011001011111110000000000111110111101
00001101100111011001111000000001010001111011110111010000001111111111111110000000
00001001001110000001000000000000110000011100000000000000000000000000011111111000
RABBIT

start_text = 'eval$s=%w'
end_text = '.join'

aa_data = rabbit.split("\n")
x_length = aa_data.first.length
y_length = aa_data.length
last_point = aa_data.last.split('1').last.length # 最終行に1がないパターンは考慮しない

bits = rabbit.gsub("\n", '').reverse.to_i(2)

bin = [Marshal.dump(bits)].pack('m').gsub("\n", '')

code = <<~CODE
  b="#{bin}"
  n=Marshal.load(b.unpack("m")[0])
  e="#{start_text}"<<39<<($s*3)
  o=""
  j=-1
  0.upto(#{y_length}*#{x_length}-1){|i|
    o<<((n[i]==1)?e[j+=1]:32)
    o<<((i%#{x_length}==(#{x_length - 1}))?10:"")
  }
  o[-#{last_point + end_text.length + 2},6]=""<<39<<"#{end_text}"
  puts(o)
CODE

code = code.split("\n").join(';')
code << '#'

file = File.new('quine_base.rb', 'w')
file.puts "#{start_text}'#{code}'#{end_text}"
